---
title: "Facebook social connectedness Index"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

dir_proj = file.path(dirname(getwd()))
dir_R = file.path(dirname(getwd()), "R")

source(file.path(dir_R,"set_up.R"))

dir_raw = file.path(dirname(getwd()), "raw_data")

```

**Social Connectedness<sub>i,j</sub>** measures the relative probability of a Facebook friendship link between a given Facebook user in location *i* and a user in location *j.* Put differently, if this measure is twice as large, a Facebook user in *i* is about twice as likely to be connected with a given Facebook user in *j*.

# The data

[download data here](https://data.humdata.org/dataset/social-connectedness-index)

It excludes the following areas: Afghanistan, Western Sahara, China, Cuba, Iraq, Israel, Iran, North Korea, Russia, Syria, Somalia, South Sudan, Sudan, Venezuela, Yemen, Crimea, Jammu and Kashmir, Donetsk, Luhansk, Sevastopol, West Bank, and Gaza.

Each dataset has three columns: user\_loc, fr\_loc, and scaled\_sci. They include every (symmetric) *i* to *j* and *j* to *i* location pair.

The August 2020 version of the datasets included are:

-   <b>International Countries</b> . Each row is a country -- country pair. Countries are denoted by their ISO2 code.

-   US Counties. Each row is a US county -- US county pair. Counties are denoted by their 5-digit FIPS code.

-   US Counties to Country. Each row is a US county --country pair. Counties are denoted by their 5-digit FIPS code, countries are denoted by their ISO2 code.

**We are interested in the *International Countries***



### Code to read the data

<br>

```{r read data, echo=TRUE}

#' get countries isocodes
codelist = countrycode::codelist %>%
  select(country.name.en, iso2c) %>%
  rename(Country = country.name.en) %>%
  mutate(iso2c = if_else(Country == "Kosovo", "XK", iso2c))

#' raw data from facebook
raw_sci_international = import(file.path(dir_raw, "country_country_aug2020.tsv")) %>%
  # filter(!is.na(user_loc)) %>%
  # filter(!is.na(fr_loc))%>%
  left_join(codelist, by = c("user_loc"="iso2c")) %>%
  rename(Country_user = Country) %>%
  left_join(codelist, by=c("fr_loc"= "iso2c")) %>%
  rename(Country_friend = Country) %>%
  mutate(status = case_when(is.na(user_loc) ~ "Missing user_loc",
                            is.na(fr_loc) ~ "Missing fr_loc",
                            is.na(user_loc) & is.na(fr_loc) ~ "Missing user_loc & fr_loc",
                            TRUE ~ "Complete")
  )

 table = DT::datatable(raw_sci_international)
 


```

### This is how the data looks like:

`r table`

## Things to explore

There are some observations with NA values either for the user_loc or the friend_loc:

<br>

```{r summary, include=TRUE}

summary_table = raw_sci_international %>%
  group_by(status) %>%
  summarise(Observations = n(), .groups = 'drop') %>%
  mutate(freq = scales::percent(Observations / sum(Observations))) %>%
  gt()

```

`r summary_table`